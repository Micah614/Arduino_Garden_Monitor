<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="javascript.js"></script>

    <title>Arduino Greenhouse Monitor Project</title>
</head>
<body>
    <h1>
        The Arduino Greenhouse Monitor and REST API Project
    </h1>
    <hr>
    <h3>
        Introduction
    </h3>
    <p>
        Welcome to the second half of the Arduino Greenhouse Monitor and REST API Project. The contents of 
        this project are presented in a jump table for your convenience, summarized by weekly project sections.
    </p>
    
    <h3>
        Project Jump Table
    </h3>
    <!--Weekly Timeline Table-->
    <div id="jump_table">
        <table style="width:100%">
            <tr>
                <th>
                    Weekly Timeline
                </th>
                <th>
                    Activity Summary
                </th>
            </tr>
            <tr>
                <td>
                    Week 6
                </td>
                <td>
                    <a href="#week_6">Week 6</a> was spent assembling the Greenhouse monitor breadboard and establishing circuit 
                    connections with the Arduino microcontroller. Besides testing things out a little, I also spotted a new learning 
                    (Udemy) resource about microservice architectures. I managed to get the pH probe meter function and the temperature probe 
                    functions up and running this week, with real-time measurements displayed in the Arduino IDE Serial Monitor window...
                </td>
            </tr>
                <td>
                    Week 7
                </td>
                <td>
                    TBD
                </td>
            </tr>
            <tr>
                <td>
                    Week 8
                </td>
                <td>
                    TBD
                </td>
            </tr>
            <tr>
                <td>
                    Week 9
                </td>
                <td>
                    TBD
                </td>
            </tr>
            <tr>
                <td>
                    Week 10
                </td>
                <td>
                    TBD
                </td>
            </tr>
            <tr>
                <td>
                    Week 11
                </td>
                <td>
                    TBD
                </td>
            </tr>
            <tr>
                <td>
                    Week 12
                </td>
                <td>
                    TBD
                </td>
            </tr>
        </table>
    </div>
    <hr>
    <div id="summaries">
        <h4 id="week_6">
            Week 6: Breadboard Wiring, Part Replacements, and Discovering Microservice Architecture Patterns. 
        </h4>
        <p>
            Week 6 was mainly spent assembling the Greenhouse monitor breadboard circuit and investigating architecture 
            patters to use with my ESP8266 transceiver module. I begain exploring microservice architectures with 
            the help of a Udemy course: <cite>"Build, deploy, and scale an E-Commerce app using Microservices built 
            with Node, React, Docker and Kubernetes"</cite>. This lecture series pointed out key differences between 
            microservice and monolithic architecture, and my aim is to develop the API accordance with these microservice 
            patterns, in the hope of extending this application in the future using Node JS, React, or a different framework.

            My current architectural design idea is to write a driver program that will "harvest" sensor 
            data at regular intervals and present this raw data to the serial bus where the messages can be read by the the 
            recieving portion of the driver firmware and inserted as a well-constructed tuple into a SQL transaction database,
            then transform this raw sensor data into an aggregate measurement and populate an OLAP style data warehouse file 
            via a trigger in order to satisfy the server GET and/or POST requests. I am hoping that further research into REST 
            API architecture involving arduino sensors will offer further clarity. 
        </p>

        <h5>
            Breadboard Basics
        </h5>

        <br>
        <!-- Save this figure for later discussion when building a serial bus becomes necessary -->
        <img src="./Images/Breadboard-Pinout.png">
        <p>
            Figure 1.) Basic Arduino Breadboard circuit pinout diagram. The top and bottom power rails (red) 
            are divided into 3.3V and 5V power supply sections. Ground rails are shown in blue and can be used 
            by any circuit component requiring a ground. The center (green) pinout locations are reserved for 
            circuit components, and for our intents and purposes acts as a serial communication hub.
        </p>

        <h5>
            Assembling, Calibrating, and Testing the pH Meter Function
        </h5>
        <p>
            First, I tracked down the following tutorial mentioning some of the parts I have on hand: 
            <cite><a href="https://www.electroniclinic.com/ph-meter-arduino-ph-meter-calibration-diymore-ph-sensor-arduino-code/" target="blank">
            "pH meter Arduino, pH Meter Calibration, DIYMORE pH Sensor Arduino Code"</a></cite>. I decided 
            to wire the positive and terminal leads to the breadboard in preparation for the serial hub 
            integration that will come later in the project. Here is another article that came in handy:
            <a href="https://cdn.awsli.com.br/969/969921/arquivos/ph-sensor-ph-4502c.pdf" target="blank">pH probe</a>.
        </p>
        <p>
            Once I placed the connections and verified a response from the pH sensor, I lined out a calibration curve 
            using vinegar and milk as my stand-in calibration solutions (real calibration solutions are on the way) and applied
            a short circuit connection to the pH probe terminal to register a neutral (i.e., pH = 7) response from the pH 
            probe. The result is a remarkably stable and robust pH meter, and I have been using it to monitor and adjust the pH of 
            the nutrient solutions in both of my hydroponic systems! The program I currently have relays updates to the IDE serial monitor 
            at a rate of around 2 Hz (2 updates/second). I also have a working driver sketch for the temperature probe, and I plan on 
            combined these two programs, along with others in the final version of the driver sketch program.
        </p>

        <h5>
            Success!! A Working pH Meter and Thermocouple.
        </h5>
        <img src="./Images/pH_meter_thermometer.jpg">

        <p>
            One of the most exciting moments this week was getting the drivers for the pH meter and 
            thermocouple up and running. Since I didn't have any real calibrating solutions on hand I decided 
            to calibrate the pH probe using milk and vinegar. As awful as this sounds, the attempt went very 
            well and I managed to produce some fairly accurate values when testing it with an off-curve calibration standard.
        </p>
        <hr>
        <br>
        <div class="box">
            <pre>
                // Hardware
                const int analogInPin = A0;  // Identity of the analog recieving pin
        
                // Variables
                float average_voltage, slope, intercept, pH;
                int buf[10],temp,NUM_BINS,avg_reading;
                unsigned long int avgValue;  // declare the aggregator variable used to sample the pH.
        
                // establish serial communication rate.
                void setup() {
                    Serial.begin(9600);
                }
        
                // driver main loop.
                void loop() {
                    for(int i=0;i<10;i++){
                        buf[i]=analogRead(analogInPin);  // read the analog value from analog-in pin "A0", place the value in the buffer.
                        delay(30);  // delay the next read for 30 ms.
                }
                for(int i=0;i<9;i++){
                    for(int j=i+1;j<10;j++){
                        if(buf[i]>buf[j]){  // This nested for-loop maintains buffer in ascending sorted order.
                            temp=buf[i];  
                            buf[i]=buf[j];  
                            buf[j]=temp;  
                        }
                    }
                }
        
                avgValue=0;
                for(int i=2;i<8;i++){  # sampling the middle six data points in the sorted buffer reduces the effect of outliers on the measurement.
                    avgValue+=buf[i];
                }
        
                int NUM_BINS = 6;  // number of readings in measurement
                int avg_reading = float(avgValue)/NUM_BINS;
                float average_voltage = avg_reading*(5.0/1024);  // discretize the phVoltage reading over a range of 5 volts.
            
                float slope = -5.7;  // slope of the calibration curve. represents the linear correlation between voltage and response. (Slope value given in the example code: -5.70)
                float intercept = 29.68; // intercept. adjust to calibrate.
                float pH = ( average_voltage * slope ) + intercept;  // calculates the final pH value. Incercept is adjusted during calibration. 
        
                Serial.print("Current pH: ");
                Serial.println(pH);
        
                delay(500);
                }
            </pre>
        </div>




    </div>
    <hr>
    <!--Navigation Menu-->
    <strong><u>Navigation Menu:</u></strong>
    <ul>
        <li>
            <a href="./index.html"><p>
                <u>Index Page</u>
            </a>
        </li>
        <li>
            <a href="./proposal.html">
                <u>Project Proposal and Timeline</u>
            </a>
        </li>
        <li>
            <a href="./tutorial_code.html">
                <u>Arduino Project Tutorials</u>
            </a>
        </li>
    </ul>

</body>
</html>